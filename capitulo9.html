<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cap√≠tulo 9 ‚Äì Testing avanzado</title>
  <link rel="stylesheet" href="./css/general.css" />
  <link rel="stylesheet" href="./css/prism.css" />
</head>
<body>
  <div class="layout">
    <button id="menu-toggle" aria-label="Mostrar men√∫" class="menu-toggle">‚ò∞</button>
    <aside class="sidebar">
      <nav>
        <h2>√çndice</h2>
        <ul>
          <li><a href="capitulo1.html">1. Introducci√≥n</a></li>
          <li><a href="capitulo2.html">2. Instalaci√≥n y configuraci√≥n</a></li>
          <li><a href="capitulo3.html">3. Estructura de un componente</a></li>
          <li><a href="capitulo4.html">4. Decoradores en profundidad</a></li>
          <li><a href="capitulo5.html">5. Ciclo de vida</a></li>
          <li><a href="capitulo6.html">6. Slots y Shadow DOM</a></li>
          <li><a href="capitulo7.html">7. Comunicaci√≥n entre componentes</a></li>
          <li><a href="capitulo8.html">8. Integraci√≥n con APIs</a></li>
          <li><a href="capitulo9.html">9. Testing avanzado</a></li>
          <li><a href="capitulo10.html">10. Optimizaci√≥n</a></li>
          <li><a href="capitulo11.html">11. Librer√≠as escalables</a></li>
          <li><a href="capitulo12.html">12. Storybook</a></li>
          <li><a href="capitulo13.html">13. Publicaci√≥n</a></li>
          <li><a href="capitulo14.html">14. Buenas pr√°cticas</a></li>
          <li><a href="capitulo15.html">15. Proyecto final</a></li>
        </ul>
      </nav>
    </aside>

    <main class="content">
      <h1>Cap√≠tulo 9: Testing avanzado</h1>

      <section>
        <h2>üß™ ¬øQu√© herramientas usa Stencil para testing?</h2>
        <p>
          Stencil.js usa <code class="inline-code">Jest</code> como entorno de pruebas por defecto. Puedes realizar tests:
        </p>
        <ul>
          <li><strong>Unitarios</strong>: l√≥gica interna del componente</li>
          <li><strong>De integraci√≥n</strong>: renderizado, eventos, slots, etc.</li>
        </ul>
      </section>

      <section>
        <h2>üìÅ Estructura de los tests</h2>
        <p>
          Por convenci√≥n, los tests van junto al componente con extensi√≥n <code class="inline-code">.spec.tsx</code>:
        </p>
        <pre><code class="language-bash">
mi-componente/
‚îú‚îÄ‚îÄ mi-componente.tsx
‚îú‚îÄ‚îÄ mi-componente.css
‚îî‚îÄ‚îÄ mi-componente.spec.tsx
        </code></pre>
      </section>

      <section>
        <h2>üîç Test unitario b√°sico</h2>
        <p>Probamos que el componente se renderiza correctamente:</p>
        <pre><code class="language-ts">
<span class="keyword">import</span> { newSpecPage } <span class="keyword">from</span> <span class="string">'@stencil/core/testing'</span>;
<span class="keyword">import</span> { SaludoPersonal } <span class="keyword">from</span> <span class="string">'./saludo-personal'</span>;

<span class="function">describe</span>('saludo-personal', () => {
  <span class="function">it</span>('renderiza por defecto', <span class="keyword">async</span> () => {
    <span class="keyword">const</span> page = <span class="keyword">await</span> newSpecPage({
      components: [SaludoPersonal],
      html: <span class="string">'&lt;saludo-personal&gt;&lt;/saludo-personal&gt;'</span>,
    });

    <span class="function">expect</span>(page.root).toBeTruthy();
    <span class="function">expect</span>(page.root.textContent).toContain(<span class="string">'Hola, visitante'</span>);
  });
});
        </code></pre>
      </section>

      <section>
        <h2>üîÅ Test con props</h2>
        <pre><code class="language-ts">
<span class="function">it</span>('muestra el nombre pasado como prop', <span class="keyword">async</span> () => {
  <span class="keyword">const</span> page = <span class="keyword">await</span> newSpecPage({
    components: [SaludoPersonal],
    html: <span class="string">'&lt;saludo-personal nombre="Ana"&gt;&lt;/saludo-personal&gt;'</span>,
  });

  <span class="function">expect</span>(page.root.textContent).toContain(<span class="string">'Hola, Ana'</span>);
});
        </code></pre>
      </section>

      <section>
        <h2>üß† Test con eventos</h2>
        <p>Tambi√©n puedes comprobar si un componente emite eventos:</p>
        <pre><code class="language-ts">
<span class="function">it</span>('emite el evento clic-personalizado', <span class="keyword">async</span> () => {
  <span class="keyword">const</span> page = <span class="keyword">await</span> newSpecPage({
    components: [MiBoton],
    html: <span class="string">'&lt;mi-boton&gt;&lt;/mi-boton&gt;'</span>,
  });

  <span class="keyword">const</span> event = <span class="keyword">jest</span>.fn();
  page.root.addEventListener(<span class="string">'clic-personalizado'</span>, event);

  page.root.click();
  <span class="function">expect</span>(event).toHaveBeenCalled();
});
        </code></pre>
      </section>

      <section>
        <h2>üí° Consejos √∫tiles</h2>
        <ul>
          <li>Usa <code class="inline-code">@State()</code> y <code class="inline-code">@Prop()</code> como base para verificar cambios</li>
          <li>Verifica contenido con <code class="inline-code">textContent</code> o <code class="inline-code">innerHTML</code></li>
          <li>Simula eventos con <code class="inline-code">click()</code> o <code class="inline-code">dispatchEvent</code></li>
        </ul>
      </section>

      <section>
        <h2>üöÄ Ejecutar los tests</h2>
        <p>Usa el siguiente comando para correr todos los tests del proyecto:</p>
        <pre><code class="language-bash">
npm test
        </code></pre>
        <p>Tambi√©n puedes lanzar Jest en modo interactivo:</p>
        <pre><code class="language-bash">
npm run test.watch
        </code></pre>
      </section>

      <section class="exercise">
        <h3>üß† Ejercicio pr√°ctico</h3>
        <p>
          Crea un test para un componente <code class="inline-code">&lt;contador-clics&gt;</code> que:
        </p>
        <ul>
          <li>Tenga un bot√≥n</li>
          <li>Al hacer clic, incremente un n√∫mero</li>
          <li>Compruebe el contenido antes y despu√©s del clic</li>
          <li>Simule el clic con <code class="inline-code">page.root.querySelector('button').click()</code></li>
        </ul>
        <p>
          Bonus: verifica que el n√∫mero inicial es 0 y el nuevo valor es 1 tras el clic.
        </p>
      </section>
    </main>
  </div>

  <footer class="footer">
  <p>&copy; 2025 Curso Avanzado de Stencil.js. Creado por Roberto de la Casa. Todos los derechos reservados.</p>
</footer>
<script src="./js/menu.js"></script>
</body>
</html>
